/*
 * DAVIS.h
 *
 *  Created on: 04 nov 2015
 *      Author: dino
 */

#ifndef SRC_DAVIS_H_
#define SRC_DAVIS_H_


#include "MOMENT.h"


float rd(float x, float y, float z);
void A2M(float nu, float a, float b, float c, float &M1, float &M2, float &M3);


extern "C"
{
	void sgesv_(const int *N, const int *nrhs, float *A, const int *lda, int *ipiv,float *b, const int *ldb, int *info);
}



class DAVIS: public MOMENT
{

	int FLAG;

	double M_1,M_2,M_3;

public:

	DAVIS();

	DAVIS(string label,double x0_i,double y0_i,double z0_i):
				MOMENT(label,x0_i,y0_i,z0_i){FLAG = 0;};

	virtual ~DAVIS();

	/*! The medium parameters are assigned to the source. We also assigns the moment tensor associated to the source. This method checks if the moment tensor is compatible with a DAVIS source. */

	void SET(MEDIUM medium_par_i,double MXX,double MYY,double MZZ,double MXY,double MXZ,double MYZ);

	/*! Computation of the displacement components (Ux=U[0], Uy=U[1], Uz=U[2]) at the observation point (x,y,z) */

	void DISPLACEMENT(double x,double y,double z,double U[])
	{
		if(FLAG == 1)
		{
			MOMENT::DISPLACEMENT(x,y,z,U);
		}
		else if(FLAG == -1)
		{
			cout << "Moment tensor is not compatible with a DAVIS source" << endl;
		}
		else if(FLAG == 0)
		{
			cout << "The source setup is not complete" << endl;
		}
	};

	/*! This method is used to retrieve the principal moments of the moment tensor. */

	void GET_pm(double &M1,double &M2,double &M3)
	{
		M1 = M_1;
		M2 = M_2;
		M3 = M_3;
	};

};



const double TABLE[78][5]=
{
		{0.001,	0.0010,	0.6667,	1.0000,	0.3333},
		{0.001,	0.0100,	0.3577,	0.3422,	0.0443},
        {0.001,	0.1000,	0.3356,	0.3335,	0.0045},
        {0.001,	0.2000,	0.3344,	0.3334,	0.0023},
		{0.001,	0.3000,	0.3340,	0.3335,	0.0016},
		{0.001,	0.4000,	0.3338,	0.3335,	0.0013},
		{0.001,	0.5000,	0.3337,	0.3335,	0.0011},
		{0.001,	0.6000,	0.3337,	0.3335,	0.0009},
        {0.001,	0.7000,	0.3336,	0.3335,	0.0009},
        {0.001,	0.8000,	0.3336,	0.3335,	0.0008},
		{0.001,	0.9000,	0.3335,	0.3335,	0.0007},
		{0.001,	1.0000,	0.3335,	0.3335,	0.0007},

		{0.010,	0.0100,	0.6667,	1.0000,	0.3334},
        {0.010,	0.1000,	0.3577,	0.3429,	0.0450},
        {0.010,	0.2000,	0.3449,	0.3366,	0.0234},
		{0.010,	0.3000,	0.3408,	0.3355,	0.0163},
		{0.010,	0.4000,	0.3388,	0.3353,	0.0128},
		{0.010,	0.5000,	0.3376,	0.3352,	0.0108},
		{0.010,	0.6000,	0.3368,	0.3352,	0.0095},
        {0.010,	0.7000,	0.3362,	0.3352,	0.0086},
        {0.010,	0.8000,	0.3358,	0.3352,	0.0079},
		{0.010,	0.9000,	0.3355,	0.3352,	0.0074},
		{0.010,	1.0000,	0.3352,	0.3352,	0.0070},

        {0.100,	0.1000,	0.6723,	1.0000,	0.3389},
        {0.100,	0.2000,	0.4977,	0.5523,	0.2162},
		{0.100,	0.3000,	0.4392,	0.4464,	0.1575},
		{0.100,	0.4000,	0.4113,	0.4074,	0.1261},
		{0.100,	0.5000,	0.3952,	0.3891,	0.1071},
		{0.100,	0.6000,	0.3848,	0.3791,	0.0945},
        {0.100,	0.7000,	0.3775,	0.3731,	0.0856},
        {0.100,	0.8000,	0.3721,	0.3693, 0.0790},
		{0.100,	0.9000,	0.3680, 0.3666, 0.0740},
		{0.100,	1.0000,	0.3648,	0.3648,	0.0701},

        {0.200,	0.2000,	0.6867,	1.0000,	0.3497},
		{0.200,	0.3000,	0.5794,	0.7034,	0.2827},
		{0.200,	0.4000,	0.5222,	0.5764,	0.2363},
		{0.200,	0.5000,	0.4876,	0.5123,	0.2049},
		{0.200,	0.6000,	0.4648,	0.4758,	0.1830},
        {0.200,	0.7000,	0.4487,	0.4531,	0.1670},
        {0.200,	0.8000,	0.4367,	0.4382,	0.1550},
		{0.200,	0.9000,	0.4275,	0.4277,	0.1457},
		{0.200,	1.0000,	0.4202, 0.4202,	0.1383},

		{0.300,	0.3000,	0.7085,	1.0000,	0.3627},
		{0.300,	0.4000,	0.6366,	0.7881,	0.3197},
		{0.300,	0.5000,	0.5899,	0.6721,	0.2854},
		{0.300,	0.6000,	0.5577,	0.6030,	0.2593},
        {0.300,	0.7000,	0.5344,	0.5587,	0.2393},
        {0.300,	0.8000,	0.5167,	0.5288, 0.2237},
		{0.300,	0.9000,	0.5030,	0.5076,	0.2113},
		{0.300,	1.0000,	0.4921,	0.4921,	0.2014},

		{0.400,	0.4000,	0.7368,	1.0000,	0.3765},
		{0.400,	0.5000,	0.6868,	0.8407,	0.3464},
		{0.400,	0.6000,	0.6506,	0.7411,	0.3208},
        {0.400,	0.7000,	0.6236,	0.6753,	0.2998},
        {0.400,	0.8000,	0.6027,	0.6298,	0.2827},
		{0.400,	0.9000,	0.5862,	0.5971,	0.2688},
		{0.400,	1.0000,	0.5728,	0.5728,	0.2574},

		{0.500,	0.5000,	0.7708,	1.0000,	0.3901},
		{0.500,	0.6000,	0.7357,	0.8760,	0.3680},
        {0.500,	0.7000,	0.7087, 0.7916,	0.3484},
        {0.500,	0.8000,	0.6873,	0.7321,	0.3316},
		{0.500,	0.9000,	0.6701,	0.6886, 0.3174},
		{0.500,	1.0000,	0.6559,	0.6559,	0.3054},

		{0.600,	0.6000,	0.8097,	1.0000,	0.4032},
        {0.600,	0.7000,	0.7856,	0.9010,	0.3863},
        {0.600,	0.8000,	0.7662,	0.8297,	0.3710},
		{0.600,	0.9000,	0.7502,	0.7770,	0.3574},
		{0.600,	1.0000,	0.7369,	0.7369,	0.3457},

        {0.700,	0.7000,	0.8528,	1.0000,	0.4153},
        {0.700,	0.8000,	0.8370,	0.9195,	0.4021},
		{0.700,	0.9000,	0.8239,	0.8591,	0.3898},
		{0.700,	1.0000,	0.8128,	0.8128,	0.3787},

        {0.800,	0.8000,	0.8994,	1.0000,	0.4263},
		{0.800,	0.9000,	0.8901,	0.9355,	0.4156},
		{0.800,	1.0000,	0.8821,	0.8821,	0.4055},

		{0.900,	0.9000,	0.9487,	1.0000,	0.4360},
		{0.900,	1.0000,	0.9445,	0.9445,	0.4271},

		{1.000,	1.0000,	1.0000,	1.0000,	0.4444},

};







//const double TABLE_range[21][2]=
//{
//		{0.666668, 1.000000},
//		{0.490265, 0.543034},
//		{0.431658, 0.434684},
//		{0.404183, 0.394678},
//		{0.388489, 0.375888},
//		{0.378393, 0.365677},
//		{0.371370, 0.359561},
//		{0.366209, 0.355637},
//		{0.362259, 0.352986},
//		{0.359141, 0.351122},
//		{0.356619, 0.349770},
//		{0.354538, 0.348763},
//		{0.352794, 0.347998},
//		{0.351311, 0.347405},
//		{0.350037, 0.346940},
//		{0.348930, 0.346569},
//		{0.347960, 0.346271},
//		{0.347105, 0.346029},
//		{0.346345, 0.345830},
//		{0.345666, 0.345666},
//		{0.333333, 0.333333}
//};









const double TABLE_range[251][2]=
{
		{0.666667, 1.000000},
		{0.487211, 0.538517},
//		{0.428602, 0.428650},
		{0.428572, 0.428572},
		{0.401387, 0.387850},
		{0.385986, 0.368528},
		{0.376162, 0.357917},
		{0.369380, 0.351481},
		{0.364427, 0.347290},
		{0.360656, 0.344411},
		{0.357692, 0.342351},
		{0.355303, 0.340826},
		{0.353336, 0.339667},
		{0.351689, 0.338766},
		{0.350290, 0.338052},
		{0.349088, 0.337477},
		{0.348043, 0.337007},
		{0.347126, 0.336619},
		{0.346316, 0.336294},
		{0.345595, 0.336021},
		{0.344949, 0.335788},
		{0.344366, 0.335588},
		{0.343839, 0.335415},
		{0.343358, 0.335266},
		{0.342920, 0.335135},
		{0.342517, 0.335020},
		{0.342146, 0.334918},
		{0.341804, 0.334829},
		{0.341486, 0.334749},
		{0.341191, 0.334678},
		{0.340917, 0.334614},
		{0.340660, 0.334556},
		{0.340420, 0.334505},
		{0.340194, 0.334458},
		{0.339983, 0.334416},
		{0.339783, 0.334377},
		{0.339595, 0.334343},
		{0.339417, 0.334311},
		{0.339249, 0.334282},
		{0.339089, 0.334255},
		{0.338938, 0.334231},
		{0.338794, 0.334209},
		{0.338657, 0.334188},
		{0.338527, 0.334169},
		{0.338402, 0.334152},
		{0.338283, 0.334136},
		{0.338170, 0.334121},
		{0.338061, 0.334108},
		{0.337957, 0.334095},
		{0.337857, 0.334083},
		{0.337761, 0.334073},
		{0.337670, 0.334063},
		{0.337581, 0.334053},
		{0.337496, 0.334045},
		{0.337414, 0.334037},
		{0.337335, 0.334030},
		{0.337259, 0.334023},
		{0.337186, 0.334016},
		{0.337115, 0.334010},
		{0.337047, 0.334005},
		{0.336981, 0.334000},
		{0.336917, 0.333995},
		{0.336855, 0.333991},
		{0.336796, 0.333987},
		{0.336738, 0.333983},
		{0.336682, 0.333980},
		{0.336627, 0.333977},
		{0.336574, 0.333974},
		{0.336523, 0.333971},
		{0.336474, 0.333968},
		{0.336425, 0.333966},
		{0.336378, 0.333964},
		{0.336333, 0.333962},
		{0.336288, 0.333960},
		{0.336245, 0.333959},
		{0.336203, 0.333957},
		{0.336163, 0.333956},
		{0.336123, 0.333954},
		{0.336084, 0.333953},
		{0.336046, 0.333952},
		{0.336009, 0.333951},
		{0.335973, 0.333951},
		{0.335938, 0.333950},
		{0.335904, 0.333949},
		{0.335871, 0.333949},
		{0.335838, 0.333948},
		{0.335807, 0.333948},
		{0.335775, 0.333948},
		{0.335745, 0.333948},
		{0.335715, 0.333947},
		{0.335686, 0.333947},
		{0.335658, 0.333947},
		{0.335630, 0.333947},
		{0.335603, 0.333947},
		{0.335577, 0.333947},
		{0.335551, 0.333948},
		{0.335525, 0.333948},
		{0.335500, 0.333948},
		{0.335476, 0.333948},
		{0.335452, 0.333948},
		{0.335429, 0.333949},
		{0.335406, 0.333949},
		{0.335383, 0.333950},
		{0.335361, 0.333950},
		{0.335339, 0.333950},
		{0.335318, 0.333951},
		{0.335297, 0.333951},
		{0.335277, 0.333952},
		{0.335257, 0.333952},
		{0.335237, 0.333953},
		{0.335218, 0.333954},
		{0.335199, 0.333954},
		{0.335180, 0.333955},
		{0.335162, 0.333955},
		{0.335144, 0.333956},
		{0.335126, 0.333957},
		{0.335109, 0.333957},
		{0.335092, 0.333958},
		{0.335075, 0.333959},
		{0.335059, 0.333960},
		{0.335043, 0.333960},
		{0.335027, 0.333961},
		{0.335011, 0.333962},
		{0.334996, 0.333963},
		{0.334981, 0.333963},
		{0.334966, 0.333964},
		{0.334951, 0.333965},
		{0.334937, 0.333966},
		{0.334922, 0.333966},
		{0.334909, 0.333967},
		{0.334895, 0.333968},
		{0.334881, 0.333969},
		{0.334868, 0.333970},
		{0.334855, 0.333970},
		{0.334842, 0.333971},
		{0.334829, 0.333972},
		{0.334817, 0.333973},
		{0.334804, 0.333974},
		{0.334792, 0.333974},
		{0.334780, 0.333975},
		{0.334768, 0.333976},
		{0.334757, 0.333977},
		{0.334745, 0.333978},
		{0.334734, 0.333979},
		{0.334723, 0.333979},
		{0.334712, 0.333980},
		{0.334701, 0.333981},
		{0.334690, 0.333982},
		{0.334679, 0.333983},
		{0.334669, 0.333984},
		{0.334659, 0.333984},
		{0.334649, 0.333985},
		{0.334639, 0.333986},
		{0.334629, 0.333987},
		{0.334619, 0.333988},
		{0.334610, 0.333988},
		{0.334600, 0.333989},
		{0.334591, 0.333990},
		{0.334581, 0.333991},
		{0.334572, 0.333992},
		{0.334563, 0.333993},
		{0.334554, 0.333993},
		{0.334546, 0.333994},
		{0.334537, 0.333995},
		{0.334528, 0.333996},
		{0.334520, 0.333997},
		{0.334512, 0.333997},
		{0.334503, 0.333998},
		{0.334495, 0.333999},
		{0.334487, 0.334000},
		{0.334479, 0.334001},
		{0.334472, 0.334001},
		{0.334464, 0.334002},
		{0.334456, 0.334003},
		{0.334449, 0.334004},
		{0.334441, 0.334005},
		{0.334434, 0.334005},
		{0.334426, 0.334006},
		{0.334419, 0.334007},
		{0.334412, 0.334008},
		{0.334405, 0.334008},
		{0.334398, 0.334009},
		{0.334391, 0.334010},
		{0.334384, 0.334011},
		{0.334377, 0.334012},
		{0.334371, 0.334012},
		{0.334364, 0.334013},
		{0.334358, 0.334014},
		{0.334351, 0.334015},
		{0.334345, 0.334015},
		{0.334339, 0.334016},
		{0.334332, 0.334017},
		{0.334326, 0.334018},
		{0.334320, 0.334018},
		{0.334314, 0.334019},
		{0.334308, 0.334020},
		{0.334302, 0.334020},
		{0.334296, 0.334021},
		{0.334290, 0.334022},
		{0.334285, 0.334023},
		{0.334279, 0.334023},
		{0.334273, 0.334024},
		{0.334268, 0.334025},
		{0.334262, 0.334025},
		{0.334257, 0.334026},
		{0.334251, 0.334027},
		{0.334246, 0.334028},
		{0.334241, 0.334028},
		{0.334236, 0.334029},
		{0.334230, 0.334030},
		{0.334225, 0.334030},
		{0.334220, 0.334031},
		{0.334215, 0.334032},
		{0.334210, 0.334032},
		{0.334205, 0.334033},
		{0.334200, 0.334034},
		{0.334196, 0.334034},
		{0.334191, 0.334035},
		{0.334186, 0.334036},
		{0.334181, 0.334036},
		{0.334177, 0.334037},
		{0.334172, 0.334038},
		{0.334167, 0.334038},
		{0.334163, 0.334039},
		{0.334159, 0.334040},
		{0.334154, 0.334040},
		{0.334150, 0.334041},
		{0.334145, 0.334041},
		{0.334141, 0.334042},
		{0.334137, 0.334043},
		{0.334133, 0.334043},
		{0.334128, 0.334044},
		{0.334124, 0.334045},
		{0.334120, 0.334045},
		{0.334116, 0.334046},
		{0.334112, 0.334046},
		{0.334108, 0.334047},
		{0.334104, 0.334048},
		{0.334100, 0.334048},
		{0.334096, 0.334049},
		{0.334092, 0.334049},
		{0.334088, 0.334050},
		{0.334084, 0.334051},
		{0.334081, 0.334051},
		{0.334077, 0.334052},
		{0.334073, 0.334052},
		{0.334070, 0.334053},
		{0.334066, 0.334053},
		{0.334062, 0.334054},
		{0.334059, 0.334054},
		{0.334055, 0.334055},
		{0.333333, 0.333333}
};









#endif /* SRC_DAVIS_H_ */
